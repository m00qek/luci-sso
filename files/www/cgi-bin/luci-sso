#!/usr/bin/ucode
import * as io_mod from 'luci_sso.io';
import * as web_mod from 'luci_sso.web';
import * as config_loader from 'luci_sso.config';
import * as router from 'luci_sso.router';

const io = io_mod.create();

try {
	const config = config_loader.load(io);
	const res = router.handle(io, config, web_mod.request(io));
	if (res && res.is_error) {
		web_mod.render_error(io, res.code, res.status);
	} else {
		web_mod.render(io, res);
	}
} catch (e) {
	web_mod.error(io, e);
}