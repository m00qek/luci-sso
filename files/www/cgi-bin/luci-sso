#!/usr/bin/ucode
import * as uci from 'uci';
import * as fs from 'fs';
import * as uclient from 'uclient';
import * as crypto from 'luci_sso.crypto';
import * as oidc from 'luci_sso.oidc';

// 1. Composition Root: Define the IO implementation for this environment
const io = {
	time: time,
	read_file: fs.readfile,
	write_file: fs.writefile,
	http_get: (url) => {
		let conn = uclient.connect(url);
		if (!conn) return null;
		let res = conn.request("GET");
		return res;
	}
};

// 2. Load Config
// 3. OIDC Discovery
// 4. Generate Auth URL
// 5. Persistence (Store signed state/verifier in a JWS for the callback)
// 6. Redirect
